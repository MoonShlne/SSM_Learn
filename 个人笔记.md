# SSM笔记

## 事务

### 1.装配事务管理实现对象

```java
   @Bean
     public TransactionManager transactionManager(DataSource dataSource){
        DataSourceTransactionManager dataSourceTransactionManager = new DataSourceTransactionManager();
        dataSourceTransactionManager.setDataSource(dataSource);
        return dataSourceTransactionManager;
    }
```

### 2.使用注解来声明事务

@Transactional

如果声明在类上则所有方法都生效

对某个方法进行个性化则再在方法上声明即可   



#### 事务的属性

##### 1.只读

在注解后面 `readOnly` 参数赋值  默认为false 

如果是true  则只能进行数据库查询操作，不能增删改操作，但是可以提高性能

> 使用场景主要为：对整个类声明了事务注解，修改只读可以对单纯的查询方法提高性能

##### 2.超时时间

修改`timeout`属性，超时自动执行回滚，并抛出异常`TransactionTimedOutException`

##### 3.事务异常

当事务抛出运行时异常时，默认回滚，但是IO异常则不会

可以单独设置回滚异常 或是 不回滚异常

`rollbackFor` 指定要回滚的异常，默认有`runtimeException` 可以添加`IoException` 防止漏网之鱼

`noRollbackFor` 指定不会滚的异常类

##### 4.隔离级别

修改`propagation` 来指定隔离级别，来解决脏读、不可重复读和幻读等问题

##### 5.事务传播行为

修改`propagation`属性设置传播属性

1. `Propagation.REQUIRED`：如果当前存在事务，则加入当前事务，否则创建一个新事务。
2. `Propagation.REQUIRES_NEW`：创建一个新事务，并在新事务中执行。如果当前存在事务，则挂起当前事务，即使新事务抛出异常，也不会影响当前事务。
3. `Propagation.NESTED`：如果当前存在事务，则在该事务中嵌套一个新事务，如果没有事务，则与`Propagation.REQUIRED`一样。
4. `Propagation.SUPPORTS`：如果当前存在事务，则加入该事务，否则以非事务方式执行。
5. `Propagation.NOT_SUPPORTED`：以非事务方式执行，如果当前存在事务，挂起该事务。
6. `Propagation.MANDATORY`：必须在一个已有的事务中执行，否则抛出异常。
7. `Propagation.NEVER`：必须在没有事务的情况下执行，否则抛出异常。







## MyBatis

1.创建pojo类

2.创建Mapper接口  （代替Dao接口）

> 接口方法不能重载，不然配置文件的唯一ID找不到对应方法

3.创建mapper.xml    编写CRUD代码  

4.创建MyBatis的配置文件， 包含数据库连接信息 以及指定 mapper.xml位置

5.运行以及测试





